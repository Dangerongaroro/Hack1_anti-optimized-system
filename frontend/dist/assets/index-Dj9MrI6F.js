import{R as e,j as t,r as l,c as a}from"./vendor-react-8DDf6oIR.js";import{a as r}from"./app-services-DZBnoK80.js";import{g as s}from"./app-experience-strings-BqK52NS_.js";import{O as n,H as o,R as i,P as c,S as d,J as u,T as m}from"./app-screens-YEYecYQN.js";import{H as p,N as g,i as x,U as h,X as f,c as y,S as b,T as v}from"./vendor-icons-CRzGubcW.js";import"./vendor-other-DxPdciDm.js";import"./vendor-supabase-Dt5fFsft.js";import"./vendor-three-BEq7hK8x.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const l of e)if("childList"===l.type)for(const e of l.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();class j extends e.Component{constructor(e){super(e),this.state={hasError:!1,error:null}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){console.error("ErrorBoundary caught an error:",e,t)}render(){return this.state.hasError?t.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:t.jsxs("div",{className:"text-center max-w-md mx-auto p-6",children:[t.jsx("h1",{className:"text-2xl font-bold text-gray-800 mb-4",children:"申し訳ございません"}),t.jsx("p",{className:"text-gray-600 mb-4",children:"アプリケーションでエラーが発生しました。"}),t.jsx("button",{onClick:()=>window.location.reload(),className:"bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700",children:"ページを再読み込み"})]})}):this.props.children}}const N=[{id:1,date:new Date("2025-05-15"),type:"music",level:1,title:"ジャズを初めて聴いた",category:"アート・創作",completed:!0,deviation:30,feedback:"positive"},{id:2,date:new Date("2025-05-18"),type:"place",level:2,title:"隣町のカフェ巡り",category:"自然・アウトドア",completed:!0,deviation:45,feedback:"positive"},{id:3,date:new Date("2025-05-22"),type:"skill",level:3,title:"プログラミング入門",category:"学習・読書",completed:!0,deviation:70,feedback:"neutral"},{id:4,date:new Date("2025-05-25"),type:"art",level:1,title:"水彩画に挑戦",category:"アート・創作",completed:!0,deviation:50,feedback:"positive"},{id:5,date:new Date("2025-05-27"),type:"outdoor",level:2,title:"早朝ランニング",category:"スポーツ・運動",completed:!0,deviation:35,feedback:"positive"}],C={totalExperiences:23,currentStreak:5,diversityScore:78,badges:["初心者探求者","アート愛好家","週末冒険家"]},k=({currentScreen:e,setCurrentScreen:l,onNavigateToRecommendation:a})=>{const r=[{id:"home",icon:p,action:()=>l("home")},{id:"recommendation",icon:g,action:a},{id:"gallery",icon:x,action:()=>l("gallery")},{id:"profile",icon:h,action:()=>l("profile")}];return t.jsx("div",{className:"fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 px-4 py-2 z-40",children:t.jsx("div",{className:"flex justify-around items-center max-w-screen-xl mx-auto",children:r.map((l=>{const a=l.icon,r=e===l.id;return t.jsx("button",{onClick:l.action,className:"flex flex-col items-center py-3 px-4 rounded-full transition-all duration-200 "+(r?"text-purple-600 bg-purple-50":"text-gray-500 bg-white hover:text-gray-700 hover:bg-gray-100"),children:t.jsx(a,{className:"w-6 h-6 "+(r?"text-purple-600":"")})},l.id)}))})})},w=e.memo((({experience:e,onClose:a,onFeedback:r,onClearMission:s})=>{const n=l.useMemo((()=>{if(!(null==e?void 0:e.date))return"日付不明";return(e.date instanceof Date?e.date:new Date(e.date)).toLocaleDateString("ja-JP",{year:"numeric",month:"long",day:"numeric"})}),[null==e?void 0:e.date]),o=l.useCallback((()=>{(null==e?void 0:e.id)&&s(e.id)}),[null==e?void 0:e.id,s]),i=l.useCallback((()=>{(null==e?void 0:e.id)&&r(e.id,"positive")}),[null==e?void 0:e.id,r]),c=l.useCallback((()=>{(null==e?void 0:e.id)&&r(e.id,"neutral")}),[null==e?void 0:e.id,r]),d=l.useCallback((()=>{(null==e?void 0:e.id)&&r(e.id,"negative")}),[null==e?void 0:e.id,r]);return e?t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:t.jsxs("div",{className:"bg-white rounded-3xl p-6 max-w-md w-full shadow-2xl",children:[t.jsxs("div",{className:"flex justify-between items-start mb-4",children:[t.jsx("h3",{className:"text-xl font-bold text-gray-800",children:e.title}),t.jsx("button",{onClick:a,className:"p-2 bg-transparent",children:t.jsx(f,{className:"w-5 h-5 text-gray-600"})})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex gap-2",children:[t.jsx("span",{className:"px-3 py-1 bg-purple-100 text-purple-700 rounded-full text-sm",children:e.category}),t.jsxs("span",{className:"px-3 py-1 bg-pink-100 text-pink-700 rounded-full text-sm",children:["レベル ",e.level]}),t.jsx("span",{className:"px-3 py-1 rounded-full text-sm "+(e.completed?"bg-green-100 text-green-700":"bg-yellow-100 text-yellow-700"),children:e.completed?"完了":"進行中"})]}),t.jsx("p",{className:"text-gray-600",children:n}),!e.completed&&t.jsx("div",{className:"border-t pt-4",children:t.jsx("button",{onClick:o,className:"w-full py-2 bg-blue-500 text-white rounded-xl hover:bg-blue-600 transition-colors",children:"達成した"})}),e.completed&&!e.feedback&&t.jsxs("div",{className:"border-t pt-4",children:[t.jsx("p",{className:"text-sm text-gray-700 mb-3",children:"この体験はどうでしたか？"}),t.jsxs("div",{className:"flex gap-2",children:[t.jsxs("button",{onClick:i,className:"flex-1 py-2 bg-green-100 text-green-700 rounded-xl hover:bg-green-200 transition-colors flex items-center justify-center gap-2",children:[t.jsx(y,{className:"w-4 h-4"}),"良かった"]}),t.jsxs("button",{onClick:c,className:"flex-1 py-2 bg-gray-100 text-gray-700 rounded-xl hover:bg-gray-200 transition-colors flex items-center justify-center gap-2",children:[t.jsx(b,{className:"w-4 h-4"}),"普通"]}),t.jsxs("button",{onClick:d,className:"flex-1 py-2 bg-red-100 text-red-700 rounded-xl hover:bg-red-200 transition-colors flex items-center justify-center gap-2",children:[t.jsx(v,{className:"w-4 h-4"}),"合わなかった"]})]})]})]})]})}):null}));w.displayName="ExperienceDetailModal";const S=({isOpen:e,onClose:l,floatingMissionsCount:a})=>e?t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:t.jsxs("div",{className:"bg-white/95 backdrop-blur-sm rounded-3xl p-6 max-w-md w-full shadow-xl relative border border-purple-200/50",children:[t.jsx("button",{onClick:l,className:"absolute top-3 right-3 text-gray-500 hover:text-gray-700 p-1 rounded-full !bg-white hover:bg-white transition-colors","aria-label":"ポップアップを閉じる",children:t.jsx(f,{className:"h-5 w-5"})}),t.jsxs("div",{className:"text-center pt-8",children:[" ",t.jsxs("p",{className:"text-lg font-semibold text-purple-800 mb-4",children:[a,"個の進行中ミッションが浮遊しています。 完了すると美しい軌跡を描きながら糸としてつながります！"]}),t.jsx("p",{className:"text-sm text-gray-600",children:"ミッションを完了して、あなたの成長の軌跡を可視化しましょう。"})]})]})}):null,D=()=>{const[e,a]=l.useState(!0),[p,g]=l.useState({avoidCategories:[],preferredCategories:[],challengeFrequency:"daily"}),[x,h]=l.useState("home"),[f,y]=l.useState((()=>{const e=localStorage.getItem("experiences");if(e)try{return JSON.parse(e).map(((e,t)=>({id:e.id||t+1,title:e.title||"無題の体験",category:e.category||"その他",level:e.level||1,completed:e.completed||!1,date:e.date?new Date(e.date):new Date,type:e.type||"general",...e})))}catch(t){console.error("Failed to parse saved experiences:",t)}return N.map((e=>({...e,date:new Date(e.date),title:e.title||"無題の体験",category:e.category||"その他"})))})),[b,v]=l.useState(1),[D,E]=l.useState({1:null,2:null,3:null}),[I,O]=l.useState(null),[P]=l.useState(C),[J,M]=l.useState(null),[F,L]=l.useState(!1),[R,T]=l.useState(!1),B=l.useCallback((async e=>{try{return{...await r.getRecommendation(e,p,f),level:e}}catch(t){console.error("API接続エラー:",t);return{...s(e),level:e}}}),[p,f]);l.useEffect((()=>{r.initialize();const e=localStorage.getItem("userPreferences");if(e){const t=JSON.parse(e);t.setupCompleted&&(g(t),v(t.challengeLevel||2),a(!1))}const t=localStorage.getItem("experiences");t&&y(JSON.parse(t).map((e=>({...e,date:new Date(e.date)}))))}),[]);const q=l.useCallback((async()=>{console.log("🎯 全レベルのお題生成を開始"),L(!1);const e={};for(let l=1;l<=3;l++)try{const t=await B(l);e[l]=t}catch(t){console.error(`❌ レベル${l}のお題生成に失敗:`,t);const a=s(l);e[l]=a}E(e),O(e[b]),L(!0)}),[B,b]),[z,A]=l.useState(!1);l.useEffect((()=>{(null==p?void 0:p.setupCompleted)&&f&&!z&&(q(),A(!0))}),[p,f,z,q]),l.useEffect((()=>{p&&f&&p.setupCompleted&&q()}),[p,f,q]),l.useEffect((()=>{D[b]&&F&&O(D[b])}),[b,D,F]);const H=l.useCallback((async()=>{try{const e=await B(b);E((t=>({...t,[b]:e}))),O(e)}catch(e){console.error("お題生成に失敗:",e);const t=s(b);E((e=>({...e,[b]:t}))),O(t)}}),[B,b]),$=l.useCallback((e=>{g(e),a(!1),localStorage.setItem("userPreferences",JSON.stringify({...e,setupCompleted:!0}))}),[]),_=l.useCallback((()=>{localStorage.removeItem("userPreferences"),localStorage.removeItem("experiences"),a(!0),g({avoidCategories:[],preferredCategories:[],challengeFrequency:"daily"}),y(N.map((e=>({...e,date:new Date(e.date)})))),E({1:null,2:null,3:null}),O(null)}),[]),G=l.useCallback((()=>{if(I){const e={id:f.length+1,date:new Date,type:I.type||"general",level:I.level||b,title:I.title||"新しい体験",category:I.category||"その他",description:I.description||"",completed:!1,deviation:30+60*Math.random()};console.log("Creating experience from challenge:",{challenge:I,newExperience:e});const t=[...f,e];y(t),h("home"),O(null),r.updatePreferences(t),localStorage.setItem("experiences",JSON.stringify(t)),T(!0)}}),[I,f,b]),K=l.useCallback((()=>{T(!1)}),[]),U=l.useCallback((async e=>{if(I){const t=I.id||`challenge_skipped_${Date.now()}`;await r.sendFeedback(t,e)}}),[I]),Q=l.useCallback((e=>{const t={id:f.length+1,...e,date:new Date,type:"journal",completed:!0,deviation:30+60*Math.random()},l=[...f,t];y(l),h("home"),r.updatePreferences(l),localStorage.setItem("experiences",JSON.stringify(l))}),[f]),V=l.useCallback((async(e,t)=>{const l=f.map((l=>l.id===e?{...l,feedback:t}:l));y(l),M(null),await r.sendFeedback(e,t),await r.updatePreferences(l),localStorage.setItem("experiences",JSON.stringify(l))}),[f]),W=l.useCallback((e=>{console.log("🎯 ミッション完了処理開始:",e);const t=f.map((t=>t.id===e?{...t,completed:!0}:t));y(t),J&&J.id===e&&M(null),requestIdleCallback((()=>{r.updatePreferences(t),localStorage.setItem("experiences",JSON.stringify(t))})),console.log("✅ ミッション完了処理完了:",e)}),[f,J]),X=l.useCallback((()=>{h("recommendation")}),[]),Y=l.useCallback((e=>{if(console.log("=== handleExperienceClick デバッグ ==="),console.log("クリックされた体験データ:",e),!e)return void console.log("無効な体験データのため処理をスキップ");let t;t="object"==typeof e&&e.id?f.find((t=>t.id===e.id))||e:"number"==typeof e?f.find((t=>t.id===e)):e,t?(console.log("selectedExperience に設定する値:",t),M(t),console.log("selectedExperience 設定完了")):console.log("体験データが見つからない")}),[f]),Z=l.useCallback((()=>{h("journal-entry")}),[]),ee=l.useCallback((e=>{e.challenges.forEach(((t,l)=>{const a={id:f.length+1+l,date:new Date,type:"theme-challenge",level:e.difficulty,title:t,category:"テーマチャレンジ",completed:!1,themeId:e.id,themeName:e.title,deviation:30+60*Math.random()};y((e=>[...e,a]))})),h("home")}),[f]);return e?t.jsx(j,{className:"min-h-screen",children:t.jsx(n,{onComplete:$})}):t.jsx("div",{className:"min-h-screen bg-gray-50",children:t.jsx(j,{children:t.jsxs("div",{className:"mx-auto bg-white w-full max-w-screen-xl relative pb-20",children:["home"===x&&t.jsx(o,{experiences:f,userStats:P,onNavigateToRecommendation:X,onExperienceClick:Y,onClearMission:W,onNavigateToJournalEntry:Z}),"recommendation"===x&&t.jsx(i,{currentChallenge:F?I:null,selectedLevel:b,setSelectedLevel:v,onGenerateChallenge:H,onAcceptChallenge:G,onSkipChallenge:U,onClose:()=>h("home")}),"profile"===x&&t.jsx(c,{userStats:P,onResetOnboarding:_}),"gallery"===x&&t.jsx(d,{experiences:f,onBack:()=>h("home")}),"journal-entry"===x&&t.jsx(u,{onBack:()=>h("home"),onSave:Q}),"theme-challenge"===x&&t.jsx(m,{onBack:()=>h("home"),onJoinChallenge:ee}),J&&t.jsx(w,{experience:J,onClose:()=>M(null),onFeedback:V,onClearMission:W}),!["journal","theme-challenge","journal-entry"].includes(x)&&t.jsx(k,{currentScreen:x,setCurrentScreen:h,onNavigateToRecommendation:X}),t.jsx(S,{isOpen:R,onClose:K,floatingMissionsCount:f.filter((e=>!e.completed)).length})]})})})};a.createRoot(document.getElementById("root")).render(t.jsx(l.StrictMode,{children:t.jsx(D,{})}));
